<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SDK Guide &#8212; Komand Plugin SDK 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Plugin Spec" href="spec.html" />
    <link rel="prev" title="Icons" href="icon.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="sdk-guide">
<h1>SDK Guide<a class="headerlink" href="#sdk-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="writing-your-plugin">
<h2>Writing your Plugin<a class="headerlink" href="#writing-your-plugin" title="Permalink to this headline">¶</a></h2>
<p>The following sections document things you need to know to develop quality plugins.</p>
<div class="section" id="version">
<h3>Version<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h3>
<p>We have Python 2.7 and 3.4 SDK images.</p>
<p>In your plugins Dockerfile, you can change the tag to match the version of python.
Use <cite>python-plugin:0.2</cite> for Python 2.7; <cite>python-plugin:0.3</cite> for 3.4:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ head -n 1 Dockerfile
FROM komand/python-plugin:0.2
</pre></div>
</div>
</div>
<div class="section" id="plugin-generation">
<h3>Plugin Generation<a class="headerlink" href="#plugin-generation" title="Permalink to this headline">¶</a></h3>
<p>As decribed in the SDK Spec document, plugin skeletons are generated by <cite>komand plugin generate python
plugin.spec.yaml</cite>. Regenerating the skeleton by running the command <strong>will overwrite the existing configuration</strong> so be
sure to save your work. This usually means copying the code you added e.g. in the <cite>run</cite> method to a different location.</p>
<p>If you decide to modify your plugin&#8217;s scheme, by editing <cite>plugin.spec.yaml</cite>, you&#8217;ll need to regenerate the
plugin skeleton or you can manually add the JSON schema to the appropriate files.</p>
<p>For example, say you decide to add a new input variable called <cite>option</cite> to the finger action in the finger plugin. You need to edit <cite>Input</cite> class like so.</p>
<div class="highlight-udiff"><div class="highlight"><pre><span></span><span class="gd">--- code_examples/python/sdk_plugin_generation.old</span>
<span class="gi">+++ code_examples/python/sdk_plugin_generation.new</span>
<span class="gu">@@ -3,6 +3,11 @@</span>
       &quot;type&quot;: &quot;string&quot;,
       &quot;title&quot;: &quot;User&quot;,
       &quot;description&quot;: &quot;User to finger&quot;
<span class="gi">+    },</span>
<span class="gi">+    &quot;options&quot;: {</span>
<span class="gi">+      &quot;type&quot;: &quot;string&quot;,</span>
<span class="gi">+      &quot;title&quot;: &quot;Options&quot;,</span>
<span class="gi">+      &quot;description&quot;: &quot;Options to the finger program&quot;</span>
     }
   },
   &quot;required&quot;: [
</pre></div>
</div>
<div class="highlight-udiff"><div class="highlight"><pre><span></span><span class="gd">--- code_examples/yaml/sdk_plugin_generation_spec.yaml.old</span>
<span class="gi">+++ code_examples/yaml/sdk_plugin_generation_spec.yaml.new</span>
<span class="gu">@@ -2,6 +2,10 @@</span>
   type: &quot;string&quot;
   description: &quot;Finger server host&quot;
   required: true
<span class="gi">+options:</span>
<span class="gi">+  type: &quot;string&quot;</span>
<span class="gi">+  description: &quot;Options to the finger program&quot;</span>
<span class="gi">+  required: false</span>
 output:
 found:
 title: Found Status
</pre></div>
</div>
<p>Once edited, you can build the new plugin with <cite>make</cite>. The metadata section is the only section in the <cite>plugin.spec.yaml</cite> where
changes don&#8217;t need to be made outside of the <cite>plugin.spec.yaml</cite> file, they&#8217;ll take effect after running <cite>make</cite>.</p>
</div>
</div>
<div class="section" id="required-variables">
<h2>Required Variables<a class="headerlink" href="#required-variables" title="Permalink to this headline">¶</a></h2>
<p>Output variables which are defined as <cite>required: false</cite>, the default, don&#8217;t have to be returned as JSON from the plugin.
They can be omitted and in some cases it&#8217;s better to omit them. For example, the finger plugin tries to grab many
attributes of a user from the finger daemon such as the real name, shell, home directory, etc.. There&#8217;s no guarantee that
all the attributes will have values, and in some cases, the absence of values doesn&#8217;t mean our plugin failed. When this
is true, we can omit returning the key/value pairs instead of setting them to empty. This is a better practice because
another plugin that depends on the output variable as input in the workflow will not get an empty value and try to
proceed with it but rather the workflow stops there.</p>
<p>Example of returning all variables, irrespective of them having a meaningful value:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">variables</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;Host&#39;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
  <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;N/A&#39;</span><span class="p">,</span> <span class="c1"># Not available is used to illustrate non-meaningful</span>
<span class="p">}</span>

<span class="k">return</span> <span class="n">variables</span>

<span class="n">A</span> <span class="n">contrived</span> <span class="n">example</span> <span class="n">of</span> <span class="n">returning</span> <span class="n">only</span> <span class="n">meaningful</span> <span class="n">variables</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">variables</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;Host&#39;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
  <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Host&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
  <span class="k">del</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Host&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Host&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
  <span class="k">del</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Host&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
  <span class="k">del</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
  <span class="k">del</span> <span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span>
<span class="k">return</span> <span class="n">variables</span>
</pre></div>
</div>
<p>We have a helper function called <cite>clean_dict</cite> that will automatically remove keys with <cite>None</cite> type values and empty
strings. It can be called like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">clean_dictionary</span> <span class="o">=</span> <span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">clean_dict</span><span class="p">(</span><span class="n">unclean_dictionary</span><span class="p">)</span>
</pre></div>
</div>
<p>More information in the Helper Library</p>
<p>In other words, don&#8217;t do this where we manually fill out values (e.g. <cite>&#8216;N/A&#8217;</cite>):</p>
<p>You can inspect the output an action in the Jobs page</p>
<img alt="_images/var_all.png" src="_images/var_all.png" />
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="actions">
<h3>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h3>
<p>Input variables defined in the <cite>plugin.spec.yaml</cite> file are available in a dictionary called <cite>params</cite> where the value can be accessed
by the variable/key name, these are our input variables names described in the <cite>plugin.spec.yaml</cite> file. We can do this in three different ways:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
  <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
  <span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
  <span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;blah&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Of these three, <cite>params.get()</cite> is the most flexible choice, because:</p>
<ul class="simple">
<li>Allows optional default value if the key is missing</li>
<li>Returns <cite>None</cite> if the key is missing whereas <cite>params[&#8216;var&#8217;] would raise `KeyError</cite>.</li>
</ul>
</div>
<div class="section" id="triggers">
<h3>Triggers<a class="headerlink" href="#triggers" title="Permalink to this headline">¶</a></h3>
<p>Triggers are long running processes that poll for / emit a new event and then send the event to the Komand engine to kick off a workflow.
Because of they&#8217;re how workflows get fed data, all workflows in Komand start with a trigger.</p>
<p>Unlike Actions, Triggers do not return anything based on their input - instead, they perform some
operation based upon it, then ferry it to the engine.</p>
<p>If triggers were configured via the spec, they will be present at</p>
<p><code class="docutils literal"><span class="pre">&lt;plugin_name&gt;/komand_&lt;plugin_name&gt;/triggers/&lt;trigger_name&gt;.py</span></code></p>
<div class="section" id="code">
<h4>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h4>
<p>Trigger code should be placed in the body of the trigger run loop.</p>
<p>You can adjust the timer to suit the plugins needs. By default, it emits an event every 5 seconds.</p>
<p>The <cite>self.send()</cite> method accepts a dictionary and is the function used to pass the dictionary to the Komand Engine to kick off a workflow.
This dictionary is then available to other plugins.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span>
  <span class="sd">&quot;&quot;&quot;Run the trigger&quot;&quot;&quot;</span>
  <span class="c1"># send a test event</span>
  <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;TODO implement this&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">({})</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-triggers">
<h4>Testing Triggers<a class="headerlink" href="#testing-triggers" title="Permalink to this headline">¶</a></h4>
<p>Testing triggers using Docker requires the use of the <cite>&#8211;debug</cite> option otherwise the trigger will fail due to attempts
to post events to an http URL that&#8217;s not available.</p>
</div>
</div>
<div class="section" id="connections">
<h3>Connections<a class="headerlink" href="#connections" title="Permalink to this headline">¶</a></h3>
<p>You can access the connection variables defined in <cite>plugin.spec.yaml</cite> while in <cite>connection.py</cite> using a dictionary called <cite>params</cite> where
the value can be accessed by the key. We can do this the long way or in shorter form:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
  <span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">)</span>
  <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>You also need to access the connection variables in the <cite>run</cite> method to get the connection info. It&#8217;s similar to the other examples.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
  <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">var</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="logging">
<h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>Log informational messages including warnings and errors, they&#8217;re displayed to the user in the Log section of the Job Output.</p>
<img alt="_images/log_var.png" src="_images/log_var.png" />
<p>Informational logging can be done via the logging helpers. A few examples are below.</p>
<p>Additionally, you can also log via raising an Exception, however this will cause the plugin to fail. See Errors</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;connecting&quot;</span><span class="p">)</span>
<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>
<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="errors">
<h2>Errors<a class="headerlink" href="#errors" title="Permalink to this headline">¶</a></h2>
<p>Raising exceptions is how we cause plugins to abort. We want them to abort when something goes wrong so the workflow
doesn&#8217;t continue.</p>
<p>We can manually raise exceptions:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;connecting&#39;</span><span class="p">)</span>
<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;connecting&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For error handling, we should handle exceptions from the methods and functions in python libraries.
We then log a detailed message, and raise an exception to abort.</p>
<p>Example for handling errors from a URL request:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="n">resp</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">resp</span>
<span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;HTTPError: </span><span class="si">%s</span><span class="s1"> for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">code</span><span class="p">),</span> <span class="n">url</span><span class="p">)</span>
<span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
  <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;URLError: </span><span class="si">%s</span><span class="s1"> for </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">reason</span><span class="p">),</span> <span class="n">url</span><span class="p">)</span>
<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;URL Request Failed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="cache">
<h2>Cache<a class="headerlink" href="#cache" title="Permalink to this headline">¶</a></h2>
<p>Plugins can use persistent storage for caching files using the <cite>enable_cache: true</cite> in the metadata section of plugin spec file.
<code class="docutils literal"><span class="pre">/var/cache</span></code> can then be used for storage across all the plugin&#8217;s containers but not in containers of other plugins. For plugins that download files from the internet, it makes it easy to check if the file already exists in the cache.</p>
<p>For interacting with the cache, you can take one of two routes depending on your need</p>
<p>You can directly interact with it via the filesystem, which is beneficial when working with other client libraries that don&#8217;t work with file descriptors or require more complex logic:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">cache_dir</span>  <span class="o">=</span> <span class="s1">&#39;/var/cache&#39;</span>
<span class="n">cache_file</span> <span class="o">=</span> <span class="n">cache_dir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;mycache&#39;</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cache_file</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;rw&#39;</span><span class="p">)</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;Do comparison&quot;&quot;&quot;</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create cachefile for next time&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>You can also use the provided helpers, which are a little simpler to work with, but are limited to only providing file descriptors</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nb">file</span> <span class="o">=</span> <span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">open_cachefile</span><span class="p">(</span><span class="s1">&#39;/var/cache/mycache&#39;</span><span class="p">)</span>
<span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">remove_cachefile</span><span class="p">(</span><span class="s1">&#39;/var/cache/mycache&#39;</span><span class="p">)</span>
<span class="bp">True</span>
<span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">check_cachefile</span><span class="p">(</span><span class="s1">&#39;/var/cache/mycache&#39;</span><span class="p">)</span>
<span class="bp">False</span>
</pre></div>
</div>
</div>
<div class="section" id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h2>
<p>The test method is used to provide tests of the plugin by returning JSON. It should be completed with practical test(s) of plugin functionality.
Raising an exception will cause the test method to fail.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span>
  <span class="sd">&quot;&quot;&quot;TODO: Build out a test action here&quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Tests are executed in the Komand WUI after configuring a plugin. A log of the JSON output is also viewable.</p>
<img alt="_images/test.png" src="_images/test.png" />
<img alt="_images/test_log.png" src="_images/test_log.png" />
<p>The user parameters are available in the method as well.</p>
<p>If the plugin is simple enough:
* It doesn&#8217;t present a rate limiting issue
* It executes quickly</p>
<p>You can have the test method call the run method.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="p">{})</span>
</pre></div>
</div>
<p>Testing Examples:
* Successful connections to API or service
* Validating known output of command</p>
<p>Example for testing the <code class="docutils literal"><span class="pre">hashit</span></code> plugin that generates hashes of a string. We can test that hashing works by comparing
known hashes of a string against the code the <code class="docutils literal"><span class="pre">hashit</span></code> plugin uses to generate them. An exception is raised if the hashes
do not match, otherwise upon success we return the JSON object of hashes.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span>
  <span class="n">a</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
  <span class="sd">&quot;&quot;&quot;Hashes of &#39;test&#39;&quot;&quot;&quot;</span>
  <span class="n">real_hashes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;md5&#39;</span><span class="p">:</span> <span class="s1">&#39;098f6bcd4621d373cade4e832627b4f6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sha1&#39;</span><span class="p">:</span> <span class="s1">&#39;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sha256&#39;</span><span class="p">:</span> <span class="s1">&#39;9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sha512&#39;</span><span class="p">:</span> <span class="s1">&#39;ee26b0dd4af7e749aa1a8ee3c10ae9923f618980772e473f8819a5d4940e0db27ac185f8a0e1d5f84f88bc887fd67b143732c304cc5fa9ad8e6f57f&gt;</span>
  <span class="p">}</span>

  <span class="n">test_hashes</span><span class="o">=</span><span class="p">{}</span>
  <span class="n">test_hashes</span><span class="p">[</span><span class="s1">&#39;md5&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
  <span class="n">test_hashes</span><span class="p">[</span><span class="s1">&#39;sha1&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
  <span class="n">test_hashes</span><span class="p">[</span><span class="s1">&#39;sha256&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
  <span class="n">test_hashes</span><span class="p">[</span><span class="s1">&#39;sha512&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha512</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

  <span class="sd">&quot;&quot;&quot;Test against correct hashes of string &#39;test&#39;&quot;&quot;&quot;</span>
  <span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">real_hashes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">test_hashes</span><span class="p">[</span><span class="n">alg</span><span class="p">]</span> <span class="o">!=</span> <span class="n">real_hashes</span><span class="p">[</span><span class="n">alg</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Hash failed&#39;</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">test_hashes</span>
</pre></div>
</div>
</div>
<div class="section" id="verifying">
<h2>Verifying<a class="headerlink" href="#verifying" title="Permalink to this headline">¶</a></h2>
<p>Before committing the plugin, always verify that the functionality works to the top of the stack. Plugins should be user
friendly and the best way to test and figure out if your plugin meets those requirements is to get it working in Komand
product. All developers should do this.</p>
<p>You can import the plugin via the command-line with <code class="docutils literal"><span class="pre">komand</span> <span class="pre">plugin</span> <span class="pre">register</span> <span class="pre">&lt;plugin.tgz&gt;</span></code> or using the web interface
described below.</p>
<img alt="_images/import_plugin.png" src="_images/import_plugin.png" />
<ol class="arabic">
<li><p class="first">Open up the web interface <cite>https://127.0.0.1:8888</cite> for the Vagrant config</p>
</li>
<li><p class="first">Authenticate</p>
</li>
<li><p class="first"><cite>Settings -&gt; Import A Plugin</cite></p>
</li>
<li><p class="first">Choose the tarball that the <cite>makefile</cite> generated</p>
</li>
<li><p class="first">Create a Workflow to use it, it&#8217;s easiest to use the API Trigger to kick it off.</p>
<img alt="_images/api_trigger.png" src="_images/api_trigger.png" />
<img alt="_images/curl.png" src="_images/curl.png" />
</li>
<li><p class="first">Publish the workflow</p>
</li>
<li><p class="first">Start the workflow by executing the CURL command with the necessary inputs</p>
<p><code class="docutils literal"><span class="pre">curl</span> <span class="pre">-X</span> <span class="pre">POST</span> <span class="pre">-d</span> <span class="pre">'{&quot;blah&quot;:</span> <span class="pre">&quot;things&quot;,</span> <span class="pre">&quot;blah2&quot;:</span> <span class="pre">&quot;morethings&quot;}'</span> <span class="pre">http://127.0.0.1:8080/v2/workflows/46/events?api_key=&lt;YOUR_API_KEY&gt;</span></code></p>
</li>
<li><p class="first">Check the closed jobs for the results</p>
</li>
</ol>
<p>Make sure everything makes sense especially the text used to described the plugin, its input, and outputs.</p>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<p>Functions are top level objects that aren&#8217;t attached to anything</p>
<p>Use good programming practices such as breaking the program into smaller functions. This makes the plugins more readable and manageable.</p>
<p>We recommend creating a utils.py file in the actions|triggers directory with your functions and importing it in the respective actions|triggers files.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ls actions/
__init__.py*      filter_bytes.py*  filter_string.py* utils.py*

$ head actions/filter_string.py
import komand
import logging
import json
import utils
</pre></div>
</div>
<p>The functions are put in the <cite>utils.py</cite> file</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ head actions/utils.py
import re

def csv_syntax_good<span class="o">(</span>csv<span class="o">)</span>:
  <span class="nv">parsed</span> <span class="o">=</span> parse_csv_string<span class="o">(</span>csv<span class="o">)</span>
  <span class="nv">size</span> <span class="o">=</span> len<span class="o">(</span>parsed<span class="o">[</span>0<span class="o">])</span>
  <span class="k">for</span> row in parsed:
    <span class="k">if</span> len<span class="o">(</span>row<span class="o">)</span> !<span class="o">=</span> size:
      <span class="k">return</span> False
  <span class="k">return</span> True

def csv_syntax_bad<span class="o">(</span>csv<span class="o">)</span>:
</pre></div>
</div>
</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<p>Methods are functions that are attached to an object, as opposed to available freely in the global scope.
The main difference here is that Methods are able to access the local (and potentially private) state of the object they&#8217;re attached to.</p>
<p>As with functions, use good programming practices such as breaking the program into smaller pieces. This makes the plugins more readable and manageable.</p>
<p>As of now, defining custom methods on something comes with a caveat: These changes will be lost upon using the <code class="docutils literal"><span class="pre">regenerate</span></code> command.
At present, the recommended solution to this is to commit custom methods in a separate file to git, run <code class="docutils literal"><span class="pre">make</span> <span class="pre">regenerate</span></code>, then
run <code class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">—</span> <span class="pre">my_lost_file</span></code></p>
<p>Because of this, you should avoid defining custom methods on generated objects where possible, and stick to utils which are easier to recover.</p>
<p>An example below is provided that we can use instead of doing a bunch of <cite>re.search`es and conditionals to test the existence of a value.
The regex in the `get_value</cite> method extracts the value from the <cite>nkey: value</cite> pair match in the stdout string.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">stdout</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Extracts value from key: value pair&#39;&#39;&#39;</span>
  <span class="sd">&#39;&#39;&#39;Example: regex = &quot;\nDomain Name: (google.com)\n&quot;&#39;&#39;&#39;</span>
  <span class="n">regex</span> <span class="o">=</span> <span class="s2">r&quot;\n&quot;</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> <span class="s2">r&quot;: (.*)\n&quot;</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">stdout</span><span class="p">)</span>
  <span class="sd">&#39;&#39;&#39;Only return the value in the group 1 if it exists&#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s1">&#39;group&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">lastindex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="o">...</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span>
  <span class="sd">&#39;&#39;&#39;Initialize list with keys for matching&#39;&#39;&#39;</span>
  <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Domain Name&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Registrar WHOIS Server&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Updated Date&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Creation Date&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Registrar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Registrar Abuse Contact Email&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Registrar Abuse Contact Phone&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Registrant Country&#39;</span><span class="p">,</span>
  <span class="p">]</span>

  <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Iterate over keys and store the extracted values into results&#39;&#39;&#39;</span>
    <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">stdout</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
<p>Once you define the function you can call it in the same python file by referring to itself e.g. <cite>self.get_value(...)</cite></p>
<p>Because of this, you should avoid defining custom methods on generated objects where possible, and stick to adding them via a separate file in the same package, which is easier to recover.</p>
<div class="highlight-go"><div class="highlight"><pre><span></span><span class="nx">def</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">MyPluginAction</span><span class="p">)</span> <span class="nx">Calculate</span><span class="p">(</span><span class="nx">scale</span> <span class="kt">float64</span><span class="p">)</span> <span class="kt">float64</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">X</span> <span class="o">*</span> <span class="nx">a</span><span class="p">.</span><span class="nx">Y</span><span class="p">)</span> <span class="o">/</span> <span class="nx">scale</span>
<span class="p">}</span>

<span class="nx">def</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">MyPluginAction</span><span class="p">)</span> <span class="nx">Run</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="c1">// Do some things</span>
  <span class="nx">bigValue</span> <span class="o">:=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">Calculate</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
  <span class="nx">smallValue</span> <span class="o">:=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">Calculate</span><span class="p">(</span><span class="mf">1000.0</span><span class="p">)</span>
  <span class="c1">// Do some more things, then finish</span>
  <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="running-plugins">
<h2>Running Plugins<a class="headerlink" href="#running-plugins" title="Permalink to this headline">¶</a></h2>
<p>To quickly test a plugin, you can invoke them via docker as below:</p>
<p>Run these in your plugins directory e.g. plugins/myplugin</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>make
docker run -i komand/myplugin sample &lt;action&gt;  &gt; test.json
docker run -i komand/myplugin <span class="nb">test</span> &lt; test.json
</pre></div>
</div>
</div>
<div class="section" id="helper-library">
<h2>Helper Library<a class="headerlink" href="#helper-library" title="Permalink to this headline">¶</a></h2>
<p>The SDK provides some simple builtin utility functions, which are defined below. You can use these in any of the
hooks for running or testing actions and triggers in the generated code</p>
<p>To make use of the helpers, import the komand namespace</p>
<p>You can make use of <code class="docutils literal"><span class="pre">dir</span></code> python builtin to fund out more about a specific function</p>
<p><code class="docutils literal"><span class="pre">dir(komand.helper.clean_dict)</span></code></p>
<p>You can also use an sdk builtin <code class="docutils literal"><span class="pre">help</span></code> method to display information in the plugin output, although this is for testing only and will result in an error in the plugin.
Avoid leaving these calls in the final plugin. You should strive to rely on the official documentation where possible.</p>
<p><code class="docutils literal"><span class="pre">help(komand.helper.clean_dict)</span></code></p>
<div class="section" id="clean-dict-dict">
<h3>clean_dict(dict)<a class="headerlink" href="#clean-dict-dict" title="Permalink to this headline">¶</a></h3>
<p>Takes a dictionary as an argument and returns a new, cleaned, dictionary</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;stuff&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;more&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span> <span class="p">}</span>
<span class="go">&quot;&quot;&quot;Keys c and e are removed&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">clean_dict</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">{&#39;a&#39;: &#39;stuff&#39;, &#39;b&#39;: 1, &#39;d&#39;: &#39;more&#39;}</span>
</pre></div>
</div>
</div>
<div class="section" id="clean-list-list">
<h3>clean_list(list)<a class="headerlink" href="#clean-list-list" title="Permalink to this headline">¶</a></h3>
<p>Takes a list as an argument and returns a new, cleaned, list</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lst</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;stuff&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;more&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">clean_list</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
<span class="go">[&#39;stuff&#39;, 1, &#39;more&#39;]</span>
</pre></div>
</div>
</div>
<div class="section" id="open-file-path">
<h3>open_file(path)<a class="headerlink" href="#open-file-path" title="Permalink to this headline">¶</a></h3>
<p>Takes a file path as a string to open and returns a file object on success or None</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">open_file</span><span class="p">(</span><span class="s1">&#39;/tmp/testfile&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;test\n&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="check-cachefile-path">
<h3>check_cachefile(path)<a class="headerlink" href="#check-cachefile-path" title="Permalink to this headline">¶</a></h3>
<p>Takes a string of the file path to check</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">check_cachefile</span><span class="p">(</span><span class="s1">&#39;/var/cache/mycache&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="go">&quot;&quot;&quot;This works too, /var/cache is not required&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">check_cachefile</span><span class="p">(</span><span class="s1">&#39;mycache&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">check_cachefile</span><span class="p">(</span><span class="s1">&#39;nofile&#39;</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
<div class="section" id="remove-cachefile-path">
<h3>remove_cachefile(path)<a class="headerlink" href="#remove-cachefile-path" title="Permalink to this headline">¶</a></h3>
<p>Takes a file path as a string</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/var/cache&#39;</span><span class="p">)</span>
<span class="go">[&#39;test&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">remove_cachefile</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/var/cache&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="open-cachefile-file">
<h3>open_cachefile(file)<a class="headerlink" href="#open-cachefile-file" title="Permalink to this headline">¶</a></h3>
<p>Takes a file path as a string</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">open_cachefile</span><span class="p">(</span><span class="s1">&#39;/var/cache/test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;stuff\n&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/var/cache&#39;</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">open_cachefile</span><span class="p">(</span><span class="s1">&#39;/var/cache/myplugin/cache.file&#39;</span><span class="p">)</span>
<span class="go">&quot;&quot;&quot;The file has been created&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">check_cachefile</span><span class="p">(</span><span class="s1">&#39;/var/cache/myplugin/cache.file&#39;</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="lock-cache-file">
<h3>lock_cache(file)<a class="headerlink" href="#lock-cache-file" title="Permalink to this headline">¶</a></h3>
<p>Takes a file path as a string</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">lock_cache</span><span class="p">(</span><span class="s1">&#39;/var/cache/lock/lock1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="unlock-cache-file-delay">
<h3>unlock_cache(file, delay)<a class="headerlink" href="#unlock-cache-file-delay" title="Permalink to this headline">¶</a></h3>
<p>Takes a file path as a string and a delay length in seconds as an int or float</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">delay</span> <span class="o">=</span> <span class="mi">60</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">unlock_cache</span><span class="p">(</span><span class="s1">&#39;/var/cache/lock/lock1&#39;</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>
<span class="go">&quot;&quot;&quot;Sixty seconds later&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_name</span> <span class="o">=</span> <span class="s1">&#39;/var/cache/lock/lock1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">unlock_cache</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="go">&quot;&quot;&quot;Sixty seconds later&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="get-hashes-string-str">
<h3>get_hashes_string(str)<a class="headerlink" href="#get-hashes-string-str" title="Permalink to this headline">¶</a></h3>
<p>Returns a dictionary of common hashes from a string</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_hashes_string</span><span class="p">(</span><span class="s1">&#39;thisisastring&#39;</span><span class="p">)</span>
<span class="go">{u&#39;sha256&#39;: &#39;572642d5581b8b466da59e87bf267ceb7b2afd880b59ed7573edff4d980eb1d5&#39;, u&#39;sha1&#39;:</span>
<span class="go">&#39;93697ac6942965a0814ed2e4ded7251429e5c7a7&#39;, u&#39;sha512&#39;:</span>
<span class="go">&#39;9145416eb9cc0c9ff3aecbe9a400f21ca2b99c927f63a9a245d22ac4fe6fe27036643e373708e3bdf7ace4f3b52573182ec6d1f38c7d25f9e06144617ad1cdc8&#39;,</span>
<span class="go">u&#39;md5&#39;: &#39;0bba161a7165a211c7435c950ee78438&#39;}</span>
</pre></div>
</div>
</div>
<div class="section" id="check-hashes-src-checksum">
<h3>check_hashes(src, checksum)<a class="headerlink" href="#check-hashes-src-checksum" title="Permalink to this headline">¶</a></h3>
<p>Returns a boolean on whether checksum was a hash of provided string</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_hashes</span><span class="p">(</span><span class="s1">&#39;thisisastring&#39;</span><span class="p">,</span> <span class="s1">&#39;0bba161a7165a211c7435c950ee78438&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_hashes</span><span class="p">(</span><span class="s1">&#39;thisisanotherstring&#39;</span><span class="p">,</span> <span class="s1">&#39;0bba161a7165a211c7435c950ee78438&#39;</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
<div class="section" id="extract-value">
<h3>extract_value()<a class="headerlink" href="#extract-value" title="Permalink to this headline">¶</a></h3>
<p>Takes 4 arguments that regexes/patterns as strings</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Shell: /bin/bash</span><span class="se">\n\t</span><span class="s1">&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">komand</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">extract_value</span><span class="p">(</span><span class="s1">r&#39;\s&#39;</span><span class="p">,</span> <span class="s1">&#39;Shell&#39;</span><span class="p">,</span> <span class="s1">r&#39;:\s(.*)\s&#39;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
<span class="go">&#39;/bin/bash&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="open-url-url">
<h3>open_url(url)<a class="headerlink" href="#open-url-url" title="Permalink to this headline">¶</a></h3>
<p>Takes a URL as a string and optionally a timeout as an int, verify as a boolean, and a dictionary of headers</p>
<p>A urllib2 obj is returned upon success. <cite>None</cite> is returned if a 304 Not modified is the response.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">urlobj</span> <span class="o">=</span> <span class="n">open_url</span><span class="p">(</span><span class="s1">&#39;http://google.com&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">&#39;&lt;!doctype html&gt;&lt;html itemscope=&quot;&quot; itemtype=&quot;http://schema.org/WebPage&quot; lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta content=&quot;Se...&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlobj</span> <span class="o">=</span> <span class="n">open_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">Range</span><span class="o">=</span><span class="s1">&#39;bytes=0-3&#39;</span><span class="p">,</span> <span class="n">Authorization</span><span class="o">=</span><span class="s1">&#39;aslfasdfasdfasdfasdf&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlobj</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="go">Auth</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlobj</span> <span class="o">=</span> <span class="n">open_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">User_Agent</span><span class="o">=</span><span class="s1">&#39;curl/0.7.9&#39;</span><span class="p">,</span> <span class="n">If_None_Match</span><span class="o">=</span><span class="n">etag</span><span class="p">)</span>
<span class="go">ERROR:root:HTTPError: 304 for http://24.151.224.211/ui/1.0.1.1038/dynamic/login.html</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">&lt;type &#39;NoneType&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlobj</span> <span class="o">=</span> <span class="n">open_url</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">User_Agent</span><span class="o">=</span><span class="s1">&#39;curl/0.7.9&#39;</span><span class="p">,</span> <span class="n">If_Modified_Since</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>
<span class="go">ERROR:root:HTTPError: 304 for http://24.151.224.211/ui/1.0.1.1038/dynamic/login.html</span>
</pre></div>
</div>
</div>
<div class="section" id="get-url-filename-url">
<h3>get_url_filename(url)<a class="headerlink" href="#get-url-filename-url" title="Permalink to this headline">¶</a></h3>
<p>Takes a URL as a string, returns filename as string or None</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://www.irongeek.com/robots.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_url_filename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="go">&#39;robots.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_url_filename</span><span class="p">(</span><span class="s1">&#39;http://203.66.168.223:83/&#39;</span><span class="p">)</span>
<span class="go">&#39;Create_By_AutoWeb.htm&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">get_url_filename</span><span class="p">(</span><span class="s1">&#39;http://www.google.com&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
<span class="gp">... </span>  <span class="k">print</span> <span class="s1">&#39;No file found&#39;</span>
<span class="go">No file found</span>
</pre></div>
</div>
<p>exec_command(path_with_args)</p>
<p>Takes a command and its arguments as a string</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">exec_command</span><span class="p">(</span><span class="s1">&#39;/bin/ls&#39;</span><span class="p">)</span>
<span class="go">{&#39;rcode&#39;: 0, &#39;stderr&#39;: &#39;&#39;, &#39;stdout&#39;:</span>
<span class="go">&#39;GO.md\nPYTHON.md\nREADME.md\nSPEC.md\nball.pyc\nimgs\nold.py\nplugins.py\nplugins.pyc\nstatic.py\nstatic.pyc\n&#39;}</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">SDK Guide</a><ul>
<li><a class="reference internal" href="#writing-your-plugin">Writing your Plugin</a><ul>
<li><a class="reference internal" href="#version">Version</a></li>
<li><a class="reference internal" href="#plugin-generation">Plugin Generation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#required-variables">Required Variables</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a><ul>
<li><a class="reference internal" href="#actions">Actions</a></li>
<li><a class="reference internal" href="#triggers">Triggers</a><ul>
<li><a class="reference internal" href="#code">Code</a></li>
<li><a class="reference internal" href="#testing-triggers">Testing Triggers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#connections">Connections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#errors">Errors</a></li>
<li><a class="reference internal" href="#cache">Cache</a></li>
<li><a class="reference internal" href="#tests">Tests</a></li>
<li><a class="reference internal" href="#verifying">Verifying</a></li>
<li><a class="reference internal" href="#functions">Functions</a></li>
<li><a class="reference internal" href="#methods">Methods</a></li>
<li><a class="reference internal" href="#running-plugins">Running Plugins</a></li>
<li><a class="reference internal" href="#helper-library">Helper Library</a><ul>
<li><a class="reference internal" href="#clean-dict-dict">clean_dict(dict)</a></li>
<li><a class="reference internal" href="#clean-list-list">clean_list(list)</a></li>
<li><a class="reference internal" href="#open-file-path">open_file(path)</a></li>
<li><a class="reference internal" href="#check-cachefile-path">check_cachefile(path)</a></li>
<li><a class="reference internal" href="#remove-cachefile-path">remove_cachefile(path)</a></li>
<li><a class="reference internal" href="#open-cachefile-file">open_cachefile(file)</a></li>
<li><a class="reference internal" href="#lock-cache-file">lock_cache(file)</a></li>
<li><a class="reference internal" href="#unlock-cache-file-delay">unlock_cache(file, delay)</a></li>
<li><a class="reference internal" href="#get-hashes-string-str">get_hashes_string(str)</a></li>
<li><a class="reference internal" href="#check-hashes-src-checksum">check_hashes(src, checksum)</a></li>
<li><a class="reference internal" href="#extract-value">extract_value()</a></li>
<li><a class="reference internal" href="#open-url-url">open_url(url)</a></li>
<li><a class="reference internal" href="#get-url-filename-url">get_url_filename(url)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="icon.html" title="previous chapter">Icons</a></li>
      <li>Next: <a href="spec.html" title="next chapter">Plugin Spec</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/sdk.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Komand.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/sdk.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>