<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Regenerating Plugins &#8212; Komand Plugin SDK 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Style Guide" href="style.html" />
    <link rel="prev" title="Plugin Spec" href="spec.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="regenerating-plugins">
<h1>Regenerating Plugins<a class="headerlink" href="#regenerating-plugins" title="Permalink to this headline">¶</a></h1>
<p>The following sections document things you need to know to regenerate the plugin. Regeneration occurs when you want to
update the plugin schema to support new actions, triggers, improved title and descriptions, etc. without manually
saving your work and updating the JSON schema.</p>
<div class="section" id="compatibility">
<h2>Compatibility<a class="headerlink" href="#compatibility" title="Permalink to this headline">¶</a></h2>
<p>Plugins developed after October 1, 2016 have the ability to be regenerated.</p>
</div>
<div class="section" id="regenerate-command">
<h2>Regenerate Command<a class="headerlink" href="#regenerate-command" title="Permalink to this headline">¶</a></h2>
<p>As decribed in the SDK Spec document, plugin skeletons are generated by running:</p>
<p><code class="docutils literal"><span class="pre">komand</span> <span class="pre">plugin</span> <span class="pre">generate</span> <span class="pre">python</span> <span class="pre">plugin.spec.yaml</span></code>.</p>
<p>If you decide to modify your plugin&#8217;s scheme, by editing <code class="docutils literal"><span class="pre">plugin.spec.yaml</span></code>, you&#8217;ll need to regenerate the plugin skeleton.</p>
<div class="section" id="process">
<h3>Process<a class="headerlink" href="#process" title="Permalink to this headline">¶</a></h3>
<p>The following process allows us to pick and choose the changes we would like to keep. This way we can obtain
the updated schema as well as select to keep our code.</p>
<ol class="arabic simple">
<li>Commit the current state of your plugin before regeneration. <strong>Work will be lost if not committed</strong>.</li>
<li>Update the <code class="docutils literal"><span class="pre">plugin.spec.yaml</span></code> file with the new schema</li>
<li>Run <code class="docutils literal"><span class="pre">make</span> <span class="pre">regenerate</span></code></li>
<li>Use <code class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></code> and <code class="docutils literal"><span class="pre">git</span> <span class="pre">diff</span></code> to examine the differences</li>
<li>Use <code class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">--</span> <span class="pre">&lt;file&gt;`</span></code> to revert back to a files state before regeneration</li>
<li>Use <code class="docutils literal"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">-p</span></code> to and y|n|s (yes, no, split) to stage changes you want to keep</li>
<li>Commit with results with <code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span></code></li>
</ol>
</div>
<div class="section" id="video">
<h3>Video<a class="headerlink" href="#video" title="Permalink to this headline">¶</a></h3>
<p>We have a video documentation of this process which may be easier to grasp.</p>
<p><a class="reference external" href="https://www.youtube.com/watch?v=g-ll1dDQmBs&amp;list=PLzmK1wbzR51maMlHMKjQoiuYFPbWWtMV0&amp;index=6">Regenerating Plugins</a></p>
</div>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Here&#8217;s an example of plugin regeneration by updating the schema (<code class="docutils literal"><span class="pre">plugin.spec.yaml</span></code>) to support:</p>
<ul class="simple">
<li>Adding a new action to lookup malware hashes</li>
<li>Change plugin title</li>
<li>Update plugin version</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ vim plugin.spec.yaml <span class="c1"># Updated the schema</span>
$ make regenerate
Generating new plugin skeleton
...
Overlaying plugin skeleton to the current directory
</pre></div>
</div>
<p>The new skeleton changed everything.</p>
<ul class="simple">
<li>Test files are deleted but need to be saved. The new skeleton doens&#8217;t have them (It starts fresh, removing everything not in it).</li>
<li>Version and title name have been included in the new skeleton files</li>
<li>The new action gets its own action file</li>
</ul>
<p>Here&#8217;s list of the modified files with <code class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></code></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git status
On branch cymon
Your branch is up-to-date with <span class="s1">&#39;origin/cymon&#39;</span>.
Changes not staged <span class="k">for</span> commit:
  <span class="o">(</span>use <span class="s2">&quot;git add/rm &lt;file&gt;...&quot;</span> to update what will be committed<span class="o">)</span>
  <span class="o">(</span>use <span class="s2">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes in working directory<span class="o">)</span>

  modified:   cymon/Makefile
  modified:   cymon/bin/komand_cymon
  modified:   cymon/komand_cymon/actions/__init__.py
  modified:   cymon/komand_cymon/actions/address_blacklist.py
  modified:   cymon/komand_cymon/actions/address_lookup.py
  modified:   cymon/komand_cymon/actions/domain_blacklist.py
  modified:   cymon/komand_cymon/actions/domain_lookup.py
  modified:   cymon/komand_cymon/actions/url_lookup.py
  modified:   cymon/plugin.spec.yaml
  modified:   cymon/setup.py
  deleted:    cymon/tests/address_blacklist.json
  deleted:    cymon/tests/domain_blacklist.json
  deleted:    cymon/tests/found_address_lookup.json
  deleted:    cymon/tests/found_domain_lookup.json
  deleted:    cymon/tests/found_url_lookup.json
  deleted:    cymon/tests/not_found_address_lookup.json
  deleted:    cymon/tests/not_found_domain_lookup.json
  deleted:    cymon/tests/not_found_url_lookup.json
</pre></div>
</div>
<p>If you want, you can inspect the differences of each file with <code class="docutils literal"><span class="pre">git</span> <span class="pre">--diff</span></code>.</p>
<p>You should see changes to the spec.yml file itself, changing the title and version of the plugin.</p>
<p>Additionally, you&#8217;ll see those changes reflected in some of the plugin itself.</p>
<p>One thing you&#8217;ll notice is the loss of all the custom code you authored. Currently there is no perfect solution
around preventing this, but there are some strategies to help recover it. We are currently looking at revising this process, so as much existing work as possible is left intact.</p>
<p>We&#8217;ll start off by saving the test files that are marked as delete because we still want those.
These tests were create for the existing actions we had in this plugin. Since we added a new action and did not remove
any of the old ones in our schema change we still the old test files.</p>
<p>The follow command checkouts the previous versions of the JSON test payloads before regenerating marked them as deleted.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git checkout -- tests/*
</pre></div>
</div>
<p>Next, let&#8217;s save our existing work in the original action files since the new skeleton cleaned out the code in the <cite>run</cite> methods.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git checkout -- komand_cymon/actions/address_blacklist.py
</pre></div>
</div>
<p>Next, we&#8217;ll update our main program, keeping the version and title changes we want. We do this by entering <cite>y</cite> for each change we want to stage.
If there was a change we didn&#8217;t want we would have entered <cite>n</cite> for no. If there&#8217;s two changes close together where we want one and not the other we can
use <cite>s</cite> to split them into smaller pieces and then choose to commit the smaller piece.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git add -p bin/komand_cymon
</pre></div>
</div>
<p>The regenerate command will also add in the new actions / triggers you defined. These new files are listed in the <code class="docutils literal"><span class="pre">Untracked</span> <span class="pre">files:</span></code> section of <code class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></code>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>Untracked files:
  <span class="o">(</span>use <span class="s2">&quot;git add &lt;file&gt;...&quot;</span> to include in what will be committed<span class="o">)</span>

  cymon/komand_cymon/actions/malware_lookup.py

We can add it by its path <span class="sb">`</span>git add komand_cymon/actions/malware_lookup.py<span class="sb">`</span>.
</pre></div>
</div>
<p>We repeat this process until the plugin looks the way we want, then we commit it
e.g. <code class="docutils literal"><span class="pre">git</span> <span class="pre">commit</span> <span class="pre">-m</span> <span class="pre">&quot;Regenerating</span> <span class="pre">plugin</span> <span class="pre">to</span> <span class="pre">support</span> <span class="pre">new</span> <span class="pre">action</span> <span class="pre">and</span> <span class="pre">updated</span> <span class="pre">title</span> <span class="pre">and</span> <span class="pre">version'.</span></code></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Regenerating Plugins</a><ul>
<li><a class="reference internal" href="#compatibility">Compatibility</a></li>
<li><a class="reference internal" href="#regenerate-command">Regenerate Command</a><ul>
<li><a class="reference internal" href="#process">Process</a></li>
<li><a class="reference internal" href="#video">Video</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="spec.html" title="previous chapter">Plugin Spec</a></li>
      <li>Next: <a href="style.html" title="next chapter">Style Guide</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/regenerating.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Komand.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/regenerating.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>